{% extends "base.html" %}
{% load static %}
{% load static %}
{% load color_tags %} {# Âä†ËΩΩËá™ÂÆö‰πâÈ¢úËâ≤Ê†áÁ≠æ #}
{% block extra_css %}

    <!-- ÂºïÂÖ•‰∏ªÈ°µ‰∏ìÁî®CSS -->
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
<!-- Âú®headÊ†áÁ≠æ‰∏≠ÂºïÂÖ•È´òÂæ∑Âú∞ÂõæAPI -->
<script src="https://webapi.amap.com/maps?v=2.0&key=512ef80e3828defb1ddc0d62e6fc0dfd&plugin=AMap.Geocoder,AMap.Geolocation"></script>
<!-- <script src="https://webapi.amap.com/maps?v=2.0&key=512ef80e3828defb1ddc0d62e6fc0dfd"></script> -->
{% endblock %}

{% block content %}
<div class="main-content-column">
        <!-- ÊñáÁ´†ËΩÆÊí≠ÂäüËÉΩ -->
        <div class="article-carousel-section">
            <h3 class="section-title">
                <i class="fas fa-book"></i> Á≤æÈÄâÊñáÁ´†
            </h3>
            <div class="carousel-container">
                <div class="carousel-slider">
                    {% for article in articles %}
                    <div class="carousel-item">
                        <!-- ÂõæÁâáÂå∫Âüü -->
                        <div class="image-content">
                            {% if article.image and article.image.url %}
                            <img src="{{ article.image.url }}" alt="{{ article.title }}" class="article-image">
                            {% else %}
                            <img src="{% static 'img/default-cover.jpg' %}" alt="ÈªòËÆ§Â∞ÅÈù¢" class="article-image">
                            {% endif %}
                        </div>
                        
                        <!-- ÊñáÂ≠óÂÜÖÂÆπÂå∫Âüü -->
                        <div class="text-content">
                            <h4 class="article-title">{{ article.title }}</h4>
                            <div class="article-excerpt-container">
                                <p class="article-excerpt">{{ article.summary|truncatechars:80 }}</p>
                            </div>
                            <div class="btn-container">
                                <a href="{{ article.get_absolute_url }}" class="btn btn-primary">ÈòÖËØªÂÖ®Êñá</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="carousel-nav">
                    {% for i in articles %}
                    <span class="carousel-dot" data-index="{{ forloop.counter0 }}"></span>
                    {% endfor %}
                </div>
            </div>
        </div>
        <!-- ÈÄèÊòéÂõæÊ†á+ÊñáÂ≠óÁÄëÂ∏ÉÊµÅ -->
        <div class="multi-stream-container">
            <h3 class="section-title">
                <i class="fas fa-book"></i> ‰ºòË¥®ËØÑËÆ∫
            </h3>
            <div class="transparent-icon-stream">
                <!-- Á¨¨‰∏ÄË°åËØÑËÆ∫ËΩ®ÈÅì -->
                <div class="icon-track" id="track-row1"></div>
                
                <!-- Á¨¨‰∫åË°åËØÑËÆ∫ËΩ®ÈÅì -->
                <div class="icon-track" id="track-row2"></div>
                
                <!-- Á¨¨‰∏âË°åËØÑËÆ∫ËΩ®ÈÅì -->
                <div class="icon-track" id="track-row3"></div>
            </div>
        </div>
        <!-- Á¨¨‰∏âÈÉ®ÂàÜÔºö‰∏™‰∫∫‰ªãÁªç -->
        <div class="profile-section">
            <!-- Â∑¶‰æßÊäÄÊúØÂ±ïÁ§∫Âå∫ -->
            <div class="tech-area">
                <!-- Â∑¶‰∏ãËßí‰∏™‰∫∫ÁÆÄ‰ªãÂå∫ -->
                <div class="personal-info">
                    <p class="greeting">‰Ω†Â•ΩÔºåÂæàÈ´òÂÖ¥ËÆ§ËØÜ‰Ω† ü§ù</p>
                    <h2 class="name">ÊàëÂè´ÈôàÈîô</h2>
                    <p class="roles">ÊòØ‰∏ÄÂêç<span>‰∫ëËÆ°ÁÆóËøêÁª¥Â∏à</span>„ÄÅ<span>Â≠¶Áîü</span>„ÄÅ<span>‰∫åÊ¨°ÂÖÉÁà±Â•ΩËÄÖ</span>„ÄÅ<span>È∫ªÁìú</span></p>
                </div>
                <div class="creativity-title">
                    <h3>ÂºÄÂêØÂàõÈÄ†Âäõ</h3>
                    <div class="underline"></div>
                </div>
                <div class="tech-grid">
                    <!-- Á¨¨‰∏ÄË°å -->
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #ff7043;">
                            <span>Python</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #0db7e4;">
                            <span>Docker</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #2196f3;">
                            <span>K8s</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #4caf50;">
                            <span>Mysql</span>
                        </div>
                    </div>
                    
                    <!-- Á¨¨‰∫åË°å -->
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #9c27b0;">
                            <span>Django</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #e91e63;">
                            <span>jenkins</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #3f51b5;">
                            <span>Github</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #ff9800;">
                            <span>Linux</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #607d8b;">
                            <span>Zabbix</span>
                        </div>
                    </div>
                    
                    <!-- Á¨¨‰∏âË°å -->
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #00bcd4;">
                            <span>ansible</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #61dafb;">
                            <span>Html5</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #2965f1;">
                            <span>CSS3</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #f7df1e;">
                            <span>Hadoop</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #e44d26;">
                            <span>Openstack</span>
                        </div>
                    </div>
                    
                    <!-- Á¨¨ÂõõË°å -->
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #f05133;">
                            <span>Git</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #41b883;">
                            <span>Redhat</span>
                        </div>
                    </div>
                    <div class="tech-item">
                        <div class="tech-icon" style="background-color: #4caf50;">
                            <span>...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Âè≥‰æßÂú∞ÂõæÂå∫Âüü -->
            <div class="right-column">
                <!-- Âú∞ÂõæÂå∫Âüü (È´òÂ∫¶Áº©Áü≠‰∏∫250px) -->
                <div class="location-area">
                    <div id="map-container">
                        <div id="amap-container" style="width:100%; height:100%;"></div>
                        <div class="location-label">
                            <i class="fas fa-map-marker-alt"></i>
                            <span id="location-text">ÊπñÂåóÊ≠¶Ê±â</span>
                        </div>
                    </div>
                </div>
                <!-- Êó∂Èíü -->
                <div class="clock-container">
                    <div class="clock-widget">
                        <div class="time-display" id="current-time">00:00:00</div>
                        <div class="date-display" id="current-date">2023Âπ¥1Êúà1Êó•</div>
                    </div>
                </div>
                
                <!-- Êñ∞Â¢ûÊ†áÁ≠æËΩÆÊí≠Âå∫Âüü -->
                <div class="tags-carousel">
                    <!-- Á¨¨‰∏ÄÁªÑÊ†áÁ≠æ -->
                    <div class="tag-group active">
                        <div class="tag-item">Âä®Êº´Áà±Â•ΩËÄÖ</div>
                        <div class="tag-item">ÂàÜ‰∫´‰∏éÁÉ≠ÂøÉ</div>
                        <div class="tag-item">‰∫ëËÆ°ÁÆóÂ∞èÁâõ</div>
                        <div class="tag-item">Ë¥™Áé©ËÄåÂ•ΩÂêÉ</div>
                    </div>
                    
                    <!-- Á¨¨‰∫åÁªÑÊ†áÁ≠æ -->
                    <div class="tag-group">
                        <div class="tag-item">ÁßØÊûÅ‰πêÂ§©Ê¥æ</div>
                        <div class="tag-item">ÂÆûÂú∞Ë°åÂä®Ê¥æ</div>
                        <div class="tag-item">Âõ¢ÈòüÂèëÂä®Êú∫</div>
                        <div class="tag-item">Áã†‰∫∫ËØù‰∏çÂ§ö</div>
                    </div>
                </div>
                <!-- ÁâπÈïø -->
                <div class="specialty-card-container">
                    <div class="specialty-card">
                        <!-- ‰∏ªÊ†áÈ¢ò‰∏éË£ÖÈ•∞ -->
                        <div class="card-header-techang">
                            <div class="card-title">ÁâπÈïø</div>
                            <div class="decoration">
                                <div class="triangle"></div>
                                <div class="triangle"></div>
                            </div>
                        </div>
                        
                        <!-- Âç°ÁâáÂÜÖÂÆπ -->
                        <div class="card-content">
                            <div class="main-text">ËÑëÂõûË∑ØÊñ∞Â•áÁöÑ‰∫∫Âù§</div>
                            <div class="secondary-text">‰∫åÊ¨°ÂÖÉÊåáÊï∞ MAX</div>
                        </div>
                        
                        <!-- ÊòüÂÖâË£ÖÈ•∞ -->
                        <div class="stardust"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 1. ‰ªéDjangoËßÜÂõæËé∑ÂèñËØÑËÆ∫Êï∞ÊçÆ
    const serverComments = JSON.parse('{{ comments_data|escapejs }}');
    
    // Á°Æ‰øùÊúâËØÑËÆ∫Êï∞ÊçÆ
    if (!serverComments || serverComments.length === 0) {
        serverComments = [
            {"author": "Á≥ªÁªü", "content": "ÊöÇÊó†ËØÑËÆ∫ÔºåÊ¨¢ËøéÁ¨¨‰∏ÄÊù°ÁïôË®ÄÔºÅ"},
            {"author": "ÂÆòÊñπ", "content": "Á≤æÂΩ©ÂÜÖÂÆπÂç≥Â∞ÜÊõ¥Êñ∞"},
            {"author": "ÊèêÁ§∫", "content": "ÁÇπÂáªÊ≠§Â§ÑÂèëË°®ÊÇ®ÁöÑËßÇÁÇπ"}
        ];
    }
    
    // ÂàùÂßãÂåñÁÄëÂ∏ÉÊµÅ
    initCommentStream(serverComments);
    
    // 2. ËΩÆÊí≠ÂäüËÉΩÔºà‰øùÊåÅÂéüÊúâÂäüËÉΩÔºâ
    initCarousel();
});

// ÂàùÂßãÂåñÁÄëÂ∏ÉÊµÅ
function initCommentStream(comments) {
    // Á°Æ‰øùÊúâË∂≥Â§üÁöÑÊï∞ÊçÆÔºàËá≥Â∞ë3Êù°Ôºâ
    if (comments.length < 3) {
        const baseComments = [
            {author: "Áî®Êà∑", content: "ËøôÊòØ‰∏ÄÊù°Á§∫‰æãËØÑËÆ∫"},
            {author: "ËÆøÂÆ¢", content: "ÁΩëÁ´ôÂÜÖÂÆπÂæàÊúâÂ∏ÆÂä©"},
            {author: "ËØªËÄÖ", content: "ÊúüÂæÖÊõ¥Â§öÊõ¥Êñ∞"}
        ];
        comments = [...comments, ...baseComments.slice(0, 3 - comments.length)];
    }
    
    // Â°´ÂÖÖ‰∏âË°åËΩ®ÈÅì
    fillCommentTrack('track-row1', comments);
    fillCommentTrack('track-row2', comments);
    fillCommentTrack('track-row3', comments);
}

// Â°´ÂÖÖÂçï‰∏™ËΩ®ÈÅì
function fillCommentTrack(trackId, comments) {
    const track = document.getElementById(trackId);
    if (!track) return;
    
    // Ê∏ÖÁ©∫ËΩ®ÈÅì
    track.innerHTML = '';
    
    // ÂàõÂª∫È¢úËâ≤Êï∞ÁªÑ
    const colors = ['#FF7043', '#3498DB', '#9B59B6', '#2ECC71', '#F1C40F', '#E74C3C'];
    
    // Ê∑ªÂä†ËØÑËÆ∫È°π
    comments.forEach((comment, index) => {
        const combo = document.createElement('div');
        combo.className = 'icon-combo';
        
        // Ëé∑Âèñ‰ΩúËÄÖÈ¶ñÂ≠óÊØç
        const initial = comment.author && comment.author.length > 0 ? 
            comment.author.charAt(0).toUpperCase() : '?';
        
        // ÈöèÊú∫ÈÄâÊã©È¢úËâ≤
        const colorIndex = Math.floor(Math.random() * colors.length);
        
        combo.innerHTML = `
            <div class="minimal-icon" style="background-color: ${colors[colorIndex]};">
                <span>${initial}</span>
            </div>
            <div class="text-bubble">${comment.content}</div>
        `;
        
        track.appendChild(combo);
    });
    
    // Ê∑ªÂä†ÂâØÊú¨Á°Æ‰øùËøûÁª≠ÊÄß
    comments.slice(0, Math.max(1, Math.floor(comments.length/2))).forEach(comment => {
        const combo = document.createElement('div');
        combo.className = 'icon-combo';
        
        const initial = comment.author && comment.author.length > 0 ? 
            comment.author.charAt(0).toUpperCase() : '?';
        
        const colorIndex = Math.floor(Math.random() * colors.length);
        
        combo.innerHTML = `
            <div class="minimal-icon" style="background-color: ${colors[colorIndex]};">
                <span>${initial}</span>
            </div>
            <div class="text-bubble">${comment.content}</div>
        `;
        
        track.appendChild(combo);
    });
}

// ËΩÆÊí≠ÂäüËÉΩ
function initCarousel() {
    const slider = document.querySelector('.carousel-slider');
    const dots = document.querySelectorAll('.carousel-dot');
    const items = document.querySelectorAll('.carousel-item');
    
    if (!slider || !items.length) return;
    
    let currentIndex = 0;
    
    function updateSlider() {
        slider.style.transform = `translateX(-${currentIndex * 100}%)`;
        
        // Êõ¥Êñ∞ÊåáÁ§∫ÁÇπÁä∂ÊÄÅ
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentIndex);
        });
    }
    
    // ÁÇπÂáªÊåáÁ§∫ÁÇπÂàáÊç¢
    dots.forEach(dot => {
        dot.addEventListener('click', () => {
            currentIndex = parseInt(dot.dataset.index);
            updateSlider();
        });
    });
    
    // Ëá™Âä®ËΩÆÊí≠
    setInterval(() => {
        currentIndex = (currentIndex + 1) % items.length;
        updateSlider();
    }, 5000);
}
</script>
<script>
$(document).ready(function() {   
    // 2. ÊñáÁ´†ËΩÆÊí≠ÂäüËÉΩ
    const slider = $('.carousel-slider');
    const items = $('.carousel-item');
    const dots = $('.carousel-dot');
    let currentIndex = 0;
    let slideInterval;
    
    // ÊòæÁ§∫ÊåáÂÆöÂπªÁÅØÁâá
    function showSlide(index) {
        slider.css('transform', `translateX(-${index * 100}%)`);
        dots.removeClass('active').eq(index).addClass('active');
        currentIndex = index;
    }
    
    // Ëá™Âä®ËΩÆÊí≠
    function startAutoSlide() {
        slideInterval = setInterval(function() {
            currentIndex = (currentIndex + 1) % items.length;
            showSlide(currentIndex);
        }, 5000);
    }
    
    // ÁÇπÈÄâÂàáÊç¢ÂπªÁÅØÁâá
    dots.click(function() {
        clearInterval(slideInterval);
        const index = $(this).data('index');
        showSlide(index);
        startAutoSlide();
    });
    
    // ÂàùÂßãÂåñËΩÆÊí≠
    showSlide(0);
    startAutoSlide();
});  // ‰øÆÂ§çÂêéÁöÑÈó≠ÂêàÔºåÂè™Êúâ‰∏Ä‰∏™Â§ßÊã¨Âè∑ÂíåÂ∞èÊã¨Âè∑
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ÂàõÂª∫ÊòüÁ©∫ËÉåÊôØ
    function createStarryBackground() {
        const profileSection = document.querySelector('.profile-section');
        const stars = 200;
        
        for (let i = 0; i < stars; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            
            // ÈöèÊú∫‰ΩçÁΩÆ
            const posX = Math.random() * 100;
            const posY = Math.random() * 100;
            star.style.left = `${posX}%`;
            star.style.top = `${posY}%`;
            
            // ÈöèÊú∫Â§ßÂ∞è
            const size = Math.random() * 3;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            
            // ÈöèÊú∫ÈÄèÊòéÂ∫¶
            const opacity = Math.random() * 0.7 + 0.1;
            star.style.opacity = opacity;
            
            // ÈöèÊú∫Âä®ÁîªÊåÅÁª≠Êó∂Èó¥
            const duration = Math.random() * 4 + 2;
            star.style.animationDuration = `${duration}s`;
            
            profileSection.appendChild(star);
        }
    }
    
    // ÂàùÂßãÂåñÊòüÁ©∫ËÉåÊôØ
    createStarryBackground();
    
});

// ‰∏™‰∫∫ÁÆÄ‰ªã‰∫§‰∫íÊïàÊûú
document.addEventListener('DOMContentLoaded', function() {
    const personalInfo = document.querySelector('.personal-info');
    
    // ÂàõÂª∫Ë£ÖÈ•∞Ê∞îÊ≥°
    function createBubbles() {
        // Ê∏ÖÈô§Áé∞ÊúâÊ∞îÊ≥°
        personalInfo.querySelectorAll('.bubble').forEach(b => b.remove());
        
        // ÂàõÂª∫Ê∞îÊ≥°
        for (let i = 0; i < 6; i++) {
            const bubble = document.createElement('div');
            bubble.classList.add('bubble');
            bubble.style.width = `${Math.random() * 80 + 20}px`;
            bubble.style.height = bubble.style.width;
            
            // ÈöèÊú∫‰ΩçÁΩÆ
            bubble.style.left = `${Math.random() * 100}%`;
            bubble.style.top = `${Math.random() * 100}%`;
            
            // ÈöèÊú∫ËÉåÊôØËâ≤
            const colors = ['rgba(255, 255, 255, 0.12)', 'rgba(255, 255, 255, 0.08)', 'rgba(255, 255, 255, 0.15)'];
            bubble.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            personalInfo.appendChild(bubble);
        }
    }
    
    if (personalInfo) {
        // ÂàùÂßãÊ∞îÊ≥°
        createBubbles();
        
        // ÁÇπÂáªÊïàÊûú
        personalInfo.addEventListener('click', function(e) {
            // Ê≥¢Á∫πÊïàÊûú
            createRipple(e);
            
            // ÂºπÂá∫Âä®Áîª
            this.style.transform = 'scale(0.95)';
            this.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.1)';
            
            // ÊñáÂ≠óÂä®Áîª
            this.querySelector('.greeting').style.transform = 'translateX(5px)';
            this.querySelector('.name').style.transform = 'scale(1.05)';
            this.querySelector('.name').style.letterSpacing = '1.5px';
            
            setTimeout(() => {
                this.style.transform = 'scale(1)';
                this.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.15)';
                this.querySelector('.greeting').style.transform = 'translateX(0)';
                this.querySelector('.name').style.transform = 'scale(1)';
                this.querySelector('.name').style.letterSpacing = '0';
                
                // Êõ¥Êñ∞Ê∞îÊ≥°‰ΩçÁΩÆ
                createBubbles();
            }, 300);
        });
        
        // Èº†Ê†áÊÇ¨ÂÅúÊïàÊûú
        personalInfo.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 15px 30px rgba(0, 0, 0, 0.2)';
        });
        
        personalInfo.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.15)';
        });
    }
    
    // ÂàõÂª∫ÁÇπÂáªÊ≥¢Á∫πÊïàÊûú
    function createRipple(e) {
        const rect = personalInfo.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const ripple = document.createElement('span');
        ripple.classList.add('ripple');
        ripple.style.left = `${x}px`;
        ripple.style.top = `${y}px`;
        
        personalInfo.appendChild(ripple);
        
        setTimeout(() => {
            ripple.remove();
        }, 600);
    }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Ê†áÁ≠æËΩÆÊí≠ÂäüËÉΩ
    const tagGroups = document.querySelectorAll('.tag-group');
    let currentIndex = 0;
    
    function startTagCarousel() {
        setInterval(() => {
            // ÁßªÈô§ÂΩìÂâçÊ¥ªË∑ÉÁªÑÁöÑactiveÁ±ª
            tagGroups.forEach(group => group.classList.remove('active'));
            
            // ËÆ°ÁÆó‰∏ã‰∏Ä‰∏™Á¥¢Âºï
            currentIndex = (currentIndex + 1) % tagGroups.length;
            
            // Ê∑ªÂä†activeÁ±ªÂà∞‰∏ã‰∏ÄÁªÑ
            tagGroups[currentIndex].classList.add('active');
        }, 2000); // 2ÁßíÂàáÊç¢‰∏ÄÊ¨°
    }
    
    // ÂêØÂä®Ê†áÁ≠æËΩÆÊí≠
    startTagCarousel();
});
// È´òÂæ∑Âú∞Âõæ
document.addEventListener('DOMContentLoaded', function() {
    // Á°Æ‰øùÈ´òÂæ∑Âú∞ÂõæAPIÂ∑≤Âä†ËΩΩ
    if (typeof AMap === 'undefined') {
        console.error('È´òÂæ∑Âú∞ÂõæAPIÊú™Âä†ËΩΩ');
        return;
    }

    const defaultPosition = [114.428586, 30.449323];
    
    try {
        // ÂàõÂª∫Âú∞Âõæ
        const map = new AMap.Map('amap-container', {
            zoom: 13,
            center: defaultPosition,
            viewMode: '3D',
            mapStyle: 'amap://styles/whitesmoke'
        });

        // Ê∑ªÂä†Ê†áËÆ∞
        const marker = new AMap.Marker({
            position: defaultPosition,
            map: map
        });

        // ‰ΩøÁî®Êèí‰ª∂Á≥ªÁªü - ‰øÆÊ≠£ÂêéÁöÑÊñπÊ≥ï
        AMap.plugin(['AMap.Geolocation', 'AMap.Geocoder', 'AMap.ToolBar', 'AMap.Scale'], function() {
            // ÂàõÂª∫Âú∞ÁêÜÁºñÁ†ÅÂô®
            const geocoder = new AMap.Geocoder();
            
            // ÂàõÂª∫Âú∞ÁêÜ‰ΩçÁΩÆÂØπË±°
            const geolocation = new AMap.Geolocation({
                enableHighAccuracy: true,
                timeout: 10000,
                buttonPosition: 'RB',
                buttonOffset: new AMap.Pixel(10, 10)
            });
            
            // Ê∑ªÂä†Êéß‰ª∂Âà∞Âú∞Âõæ
            map.addControl(geolocation);
            
            // ÂÆâÂÖ®ÁöÑ‰∫ã‰ª∂ÁõëÂê¨
            if (geolocation && typeof geolocation.on === 'function') {
                // ÂÆö‰ΩçÊàêÂäü‰∫ã‰ª∂
                geolocation.on('complete', function(data) {
                    console.log("ÂÆö‰ΩçÊàêÂäü:", data);
                    if (data.position) {
                        const position = [data.position.lng, data.position.lat];
                        marker.setPosition(position);
                        map.setCenter(position);
                        
                        // Êõ¥Êñ∞‰ΩçÁΩÆÊñáÂ≠ó
                        updateLocationText(geocoder, position);
                    }
                });
                
                // ÂÆö‰ΩçÂ§±Ë¥•‰∫ã‰ª∂
                geolocation.on('error', function(data) {
                    console.log("ÂÆö‰ΩçÂ§±Ë¥•:", data);
                    updateLocationText(geocoder, defaultPosition, "ÊπñÂåóÁúÅÊ≠¶Ê±âÂ∏Ç");
                });
            } else {
                console.warn("geolocationÂØπË±°Êú™Ê≠£Á°ÆÂàùÂßãÂåñ");
                updateLocationText(geocoder, defaultPosition, "ÊπñÂåóÁúÅÊ≠¶Ê±âÂ∏Ç");
            }
            
            // ÂºÄÂßãÂÆö‰Ωç
            geolocation.getCurrentPosition();
        });
        
        // Ê∑ªÂä†Áº©ÊîæÊéß‰ª∂
        const toolBar = new AMap.ToolBar();
        const scale = new AMap.Scale();
        map.addControl(toolBar);
        map.addControl(scale);

    } catch (error) {
        console.error('Âú∞ÂõæÂàùÂßãÂåñÂ§±Ë¥•:', error);
        // ÊòæÁ§∫ÈªòËÆ§‰ΩçÁΩÆ
        document.getElementById('location-text').textContent = "ÊπñÂåóÁúÅÊ≠¶Ê±âÂ∏Ç";
    }
});

// Êõ¥Êñ∞‰ΩçÁΩÆÊñáÊú¨ÁöÑÂáΩÊï∞
function updateLocationText(geocoder, position, fallback = "Êú™Áü•‰ΩçÁΩÆ") {
    geocoder.getAddress(position, function(status, result) {
        const locationText = document.getElementById('location-text');
        if (!locationText) return;
        
        if (status === 'complete' && result.regeocode) {
            locationText.textContent = result.regeocode.formattedAddress || 
                                     result.regeocode.addressComponent.city + 
                                     result.regeocode.addressComponent.district;
        } else {
            locationText.textContent = fallback;
        }
    });
}
</script>
    
<style>
    .custom-marker {
        font-size: 36px;
        color: #e74c3c;
        text-shadow: 0 0 15px rgba(231, 76, 60, 0.3);
        animation: markerPulse 1.5s infinite;
    }
    
    @keyframes markerPulse {
        0% { transform: translateY(0) scale(1); }
        50% { transform: translateY(-5px) scale(1.2); }
        100% { transform: translateY(0) scale(1); }
    }


</style>
<script>
    // ÂàõÂª∫Ë£ÖÈ•∞ÊòüÊòü
    document.addEventListener('DOMContentLoaded', function() {
        const card = document.querySelector('.specialty-card');
        if (!card) return;
        
        for (let i = 0; i < 15; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            
            // ÈöèÊú∫‰ΩçÁΩÆ
            const posX = Math.random() * 100;
            const posY = Math.random() * 100;
            star.style.left = `${posX}%`;
            star.style.top = `${posY}%`;
            
            // ÈöèÊú∫Â§ßÂ∞è
            const size = Math.random() * 2 + 1;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            
            // ÈöèÊú∫Âä®ÁîªÂª∂Ëøü
            const delay = Math.random() * 3;
            star.style.animationDelay = `${delay}s`;
            
            card.appendChild(star);
        }
    });
</script>
<script>
    // Ê∑ªÂä†Êó∂ÈíüÂäüËÉΩ
    function updateClock() {
        const now = new Date();
        
        // Ê†ºÂºèÂåñÊó∂Èó¥ HH:MM:SS
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        
        // Ê†ºÂºèÂåñÊó•Êúü YYYYÂπ¥MMÊúàDDÊó•
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        
        // Êõ¥Êñ∞ÊòæÁ§∫
        document.getElementById('current-time').textContent = `${hours} ${minutes} ${seconds}`;
        document.getElementById('current-date').textContent = `${year}Âπ¥${month}Êúà${day}Êó•`;
    }
    
    // ÂàùÂßãÂåñÂπ∂ÊØèÁßíÊõ¥Êñ∞Êó∂Èíü
    document.addEventListener('DOMContentLoaded', function() {
        updateClock();
        setInterval(updateClock, 1000);
    });
</script>
{% endblock %}